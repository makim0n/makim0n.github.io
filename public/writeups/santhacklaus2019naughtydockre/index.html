<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>[Santhacklaus 2019] - Naughty Docker - Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)</title><meta name=Description content="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><meta property="og:title" content="[Santhacklaus 2019] - Naughty Docker"><meta property="og:description" content="It looks like a naughty developer has been deploying a Docker image on a Santa production server a few days before Christmas. He was in a rush and was not able to properly pass all security checks on the built Docker image. Would be a shame if this image could give you an SSH access to the production server&mldr; http://46.30.204.47&#34;
Etat des lieux En allant sur l&rsquo;IP donnée dans l&rsquo;énoncé, on trouve une note nous donnait accès au docker en question."><meta property="og:type" content="article"><meta property="og:url" content="maki.bzh/writeups/santhacklaus2019naughtydockre/"><meta property="og:image" content="/logo.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2019-12-22T21:57:40+08:00"><meta property="article:modified_time" content="2019-12-22T21:57:40+08:00"><meta property="og:site_name" content="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/logo.png"><meta name=twitter:title content="[Santhacklaus 2019] - Naughty Docker"><meta name=twitter:description content="It looks like a naughty developer has been deploying a Docker image on a Santa production server a few days before Christmas. He was in a rush and was not able to properly pass all security checks on the built Docker image. Would be a shame if this image could give you an SSH access to the production server&mldr; http://46.30.204.47&#34;
Etat des lieux En allant sur l&rsquo;IP donnée dans l&rsquo;énoncé, on trouve une note nous donnait accès au docker en question."><meta name=application-name content="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><meta name=apple-mobile-web-app-title content="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=maki.bzh/writeups/santhacklaus2019naughtydockre/><link rel=prev href=maki.bzh/writeups/santhacklaus2019revmomon/><link rel=next href=maki.bzh/writeups/santhacklaus2019jacquiesheerhask/><link rel=stylesheet href=/maki.bzh/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"[Santhacklaus 2019] - Naughty Docker","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"maki.bzh\/writeups\/santhacklaus2019naughtydockre\/"},"image":["\/images\/Apple-Devices-Preview.png"],"genre":"writeups","keywords":"santhacklaus, claranet, forensic, docker","wordcount":994,"url":"maki.bzh\/writeups\/santhacklaus2019naughtydockre\/","datePublished":"2019-12-22T21:57:40+08:00","dateModified":"2019-12-22T21:57:40+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"\/lib\/images\/avatar.png"},"author":{"@type":"Person","name":"Maki"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'dark'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'dark'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=maki.bzh/ title="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/maki.bzh/posts/>Posts </a><a class=menu-item href=/maki.bzh/shorts/>Shorts </a><a class=menu-item href=/maki.bzh/offers/>Offers </a><a class=menu-item href=/maki.bzh/writeups/>Writeups </a><a class=menu-item href=/maki.bzh/tags/>Tags </a><a class=menu-item href=/maki.bzh/about/>About </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=maki.bzh/ title="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/maki.bzh/posts/ title>Posts</a><a class=menu-item href=/maki.bzh/shorts/ title>Shorts</a><a class=menu-item href=/maki.bzh/offers/ title>Offers</a><a class=menu-item href=/maki.bzh/writeups/ title>Writeups</a><a class=menu-item href=/maki.bzh/tags/ title>Tags</a><a class=menu-item href=/maki.bzh/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster">[Santhacklaus 2019] - Naughty Docker</h1><div class=content id=content><blockquote><p>It looks like a naughty developer has been deploying a Docker image on a Santa production server a few days before Christmas. He was in a rush and was not able to properly pass all security checks on the built Docker image. Would be a shame if this image could give you an SSH access to the production server&mldr; http://46.30.204.47"</p></blockquote><h2 id=etat-des-lieux>Etat des lieux</h2><p>En allant sur l&rsquo;IP donnée dans l&rsquo;énoncé, on trouve une note nous donnait accès au docker en question.</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_2f8aac3f4d10eadee50622e089a83af7.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_2f8aac3f4d10eadee50622e089a83af7.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_2f8aac3f4d10eadee50622e089a83af7.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_2f8aac3f4d10eadee50622e089a83af7.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_2f8aac3f4d10eadee50622e089a83af7.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_2f8aac3f4d10eadee50622e089a83af7.png></p><p>Avec cette note, on sait que l&rsquo;on cherche un accès SSH donc potentiellement:</p><ul><li>username ;</li><li>password et / ou clé ;</li><li>adresse IP de la machine de prod ;</li><li>port ssh si non standard (22/TCP).</li></ul><p>La première chose à faire est donc de récupérer ce docker:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; docker run --rm -p 3000:3000 -d santactf/app
</span></span><span class=line><span class=cl>Unable to find image <span class=s1>&#39;santactf/app:latest&#39;</span> locally
</span></span><span class=line><span class=cl>latest: Pulling from santactf/app
</span></span><span class=line><span class=cl>844c33c7e6ea: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>ada5d61ae65d: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>f8427fdf4292: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>f025bafc4ab8: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>7a9577c07934: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>add4f74c413b: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>1ee7a33fb93f: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>08ab1881dcea: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>96f3027f0dbd: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>cb67eac57f41: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>bf44330d5df8: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>4932e843cace: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>f0b9c596601c: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>Digest: sha256:621c884f7ddd0351fbb114e0b9c1d4d3b0e309cb5c5efc9ce872fd201af79cad
</span></span><span class=line><span class=cl>Status: Downloaded newer image <span class=k>for</span> santactf/app:latest
</span></span><span class=line><span class=cl>fe704e6f41dc44e27d32d4b6de9d64cc7bf520cfcdc94c2c15b7e35acc3214b0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; docker ps
</span></span><span class=line><span class=cl>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
</span></span><span class=line><span class=cl>fe704e6f41dc        santactf/app        <span class=s2>&#34;docker-entrypoint.s…&#34;</span>   <span class=m>51</span> seconds ago      Up <span class=m>49</span> seconds       0.0.0.0:3000-&gt;3000/tcp   cranky_khorana
</span></span></code></pre></td></tr></table></div></div><p>Avant de commencer dans le vif du challenge, une petite recherche google a permis d&rsquo;avoir des pistes à creuser:</p><blockquote><p><a href=https://www.intrinsec.com/docker-leak/ target=_blank rel="noopener noreffer">https://www.intrinsec.com/docker-leak/</a></p></blockquote><p>Même si leur outil a l&rsquo;air vraiment jolie, on va le faire à l&rsquo;ancienne: avec du bash et du cervelet.</p><h2 id=différence-entre-docker-save-et-export>Différence entre docker save et export</h2><p>Avant de faire un docker save de notre image, il est important de s&rsquo;intéresser à la différence entre un docker save et un docker export. Les deux ont plus ou moins la même finalité: sauvegarder un container et le redéployer.</p><p>La différence majeure est qu&rsquo;un docker export ne va pas garder les meta données, ni les layer d&rsquo;un container. Quant à un docker save, il va tout récupérer et faire un beau tar avec.</p><p>Le tool de intrinsec se base sur les layer du container pour permettre à l&rsquo;utilisateur de chercher à l&rsquo;intérieur et ainsi récupérer des secrets.</p><p>Cet article en parle bien : <a href=https://tuhrig.de/difference-between-save-and-export-in-docker/ target=_blank rel="noopener noreffer">https://tuhrig.de/difference-between-save-and-export-in-docker/</a></p><h2 id=sauver-le-soldat-santa>Sauver le soldat Santa</h2><p>On peut voir sur l&rsquo;image suivante, que l&rsquo;archive tar générée par <code>docker save</code> contient l&rsquo;architecture suivante:</p><ul><li><strong>hash.tar</strong>: un hash par layer;<ul><li><strong>json</strong>: l&rsquo;état du docker au moment du layer;</li><li><strong>layer.tar</strong>: l&rsquo;ensemble des fichiers du layer;</li><li><strong>VERSION</strong>: la version du docker.</li></ul></li><li><strong>hash.json</strong>: un &ldquo;résumé&rdquo; de tous les layers générés et les commandes associés;</li><li><strong>manifest.json</strong>: répertorie tous les hashs des différents layers;</li><li><strong>repositories</strong> (format json): contient le hash de la dernière version du docker.</li></ul><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_0904433c031ddbc64f15130b902b9119.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_0904433c031ddbc64f15130b902b9119.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_0904433c031ddbc64f15130b902b9119.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_0904433c031ddbc64f15130b902b9119.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_0904433c031ddbc64f15130b902b9119.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_0904433c031ddbc64f15130b902b9119.png></p><p>Les données que l&rsquo;on chercher doivent être dans un des &ldquo;layer.tar&rdquo;.</p><h2 id=localiser-les-fichiers-utiles>Localiser les fichiers utiles</h2><p>La première chose à faire est de lister l&rsquo;ensemble des fichiers dans les différents &ldquo;layer.tar&rdquo;, ça sera plus simple pour grepper dedans après:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=k>for</span> i in <span class=k>$(</span>ls <span class=p>|</span> grep -E <span class=s1>&#39;^[a-f0-9]{64}$&#39;</span><span class=k>)</span><span class=p>;</span> <span class=k>do</span> tar -tf <span class=nv>$i</span>/layer.tar <span class=p>|</span>tee <span class=s2>&#34;</span><span class=nv>$i</span><span class=s2>&#34;</span>_out<span class=p>;</span> <span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ls <span class=p>|</span>grep out
</span></span><span class=line><span class=cl>0425a7cec03536e53ffcd89abeab827ee12987209a0d31085b43cf01b8c8b2cb_out
</span></span><span class=line><span class=cl>05f684efc5012328cdbde4e3814eed1240f41d06e4dcb44506705a7705cf199e_out
</span></span><span class=line><span class=cl>34c306ec137d785a0422942d8960b913fa7ff1ec66339b699bb3de02ce6770c6_out
</span></span><span class=line><span class=cl>3b139c8076d9c5ea6935edb9f644a4dd9caec1acb1217b9492fae4bbe3ff3725_out
</span></span><span class=line><span class=cl>5c1926c54c7194b9886f0007f2cfa0a9e166b8985842e55fc9d8e888254663de_out
</span></span><span class=line><span class=cl>986a7d85c875d79a1cd37dcd7e4e110cbf6ede072d062dfb0eaf10f006ebefd9_out
</span></span><span class=line><span class=cl>a67d35ec1f3fd055009a18e40d35ccbbb31da927e5d2c421ec43e98db0d08678_out
</span></span><span class=line><span class=cl>a934c4c71d618bab83432e24a12640ff9d474df3529fa790cb0f9d059d82c7dd_out
</span></span><span class=line><span class=cl>b4d27d4e4f5bb8bfe5bc92f8b3cbf3f0f5042fe120a40833fc0247deb728f961_out
</span></span><span class=line><span class=cl>b5116739ab4c01c43f0ba2feab4358c367ca86c085fad5223ce03d6bb7933fe3_out
</span></span><span class=line><span class=cl>be3d4ffa7682700bcbc51a8655568428c4979c5464169a286208e9e03f7673a5_out
</span></span><span class=line><span class=cl>c03933430e12aa2893ee247934be44c86f5c1878904d7a1bfe665ccd548bde5d_out
</span></span><span class=line><span class=cl>f0e0774e1b8e3c943a4b910e773664c81cfcadda8a388040c842fb37b8a0e467_out
</span></span></code></pre></td></tr></table></div></div><p>Dans le fichier <code>ddde36e2209357c424cca26ac5a0b46c2f864be797c053bed700422177ba7261.json</code>, le résumé de tous les layers, on peut voir que l&rsquo;utilisateur supprime le <code>.bash_history</code> et le <code>.bashrc</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat ddde36e2209357c424cca26ac5a0b46c2f864be797c053bed700422177ba7261.json <span class=p>|</span> jq
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_b1c91ed63580e8e28ebaabccbd9cdb4f.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_b1c91ed63580e8e28ebaabccbd9cdb4f.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_b1c91ed63580e8e28ebaabccbd9cdb4f.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_b1c91ed63580e8e28ebaabccbd9cdb4f.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_b1c91ed63580e8e28ebaabccbd9cdb4f.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_b1c91ed63580e8e28ebaabccbd9cdb4f.png></p><p>Maintenant, il faut localiser un &ldquo;layer.tar&rdquo; contenant un <code>.bash_history</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ grep -ari <span class=s1>&#39;/\.bash..&#39;</span> *_out
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_efabbd1d5b9e45487f16e8e1194e905e.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_efabbd1d5b9e45487f16e8e1194e905e.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_efabbd1d5b9e45487f16e8e1194e905e.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_efabbd1d5b9e45487f16e8e1194e905e.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_efabbd1d5b9e45487f16e8e1194e905e.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_efabbd1d5b9e45487f16e8e1194e905e.png></p><p>Il semblerait que notre archive soit le layer: <code>be3d4ffa7682700bcbc51a8655568428c4979c5464169a286208e9e03f7673a5</code></p><h2 id=extraction-des-premières-informations>Extraction des premières informations</h2><p>Il semblerait que la logique soit bonne:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> be3d4ffa7682700bcbc51a8655568428c4979c5464169a286208e9e03f7673a5 <span class=o>&amp;&amp;</span> tar xvf layer.tar
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_afe991c5f2bf8c1e49a8f3aa39e8c3aa.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_afe991c5f2bf8c1e49a8f3aa39e8c3aa.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_afe991c5f2bf8c1e49a8f3aa39e8c3aa.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_afe991c5f2bf8c1e49a8f3aa39e8c3aa.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_afe991c5f2bf8c1e49a8f3aa39e8c3aa.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_afe991c5f2bf8c1e49a8f3aa39e8c3aa.png></p><p>Les fameux fichiers supprimés, mais aussi des archives de backup, ça sent bon. Avec un simple <code>cat</code> sur ce fichier, on voit qu&rsquo;il a fait beaucoup de commandes:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat .bash_history <span class=p>|</span>wc -l
</span></span><span class=line><span class=cl><span class=m>153</span>
</span></span></code></pre></td></tr></table></div></div><p>Mais on sait qu&rsquo;on cherche de quoi se connecter en ssh:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat .bash_history <span class=p>|</span> grep ssh
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_4e1b7bf3f0a60323447cce9109c089c3.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_4e1b7bf3f0a60323447cce9109c089c3.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_4e1b7bf3f0a60323447cce9109c089c3.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_4e1b7bf3f0a60323447cce9109c089c3.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_4e1b7bf3f0a60323447cce9109c089c3.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_4e1b7bf3f0a60323447cce9109c089c3.png></p><p>Dans la liste des informations à trouver, on vient de récupérer:</p><ul><li>username: rudolf-the-reindeer ;</li><li>adresse IP de la machine de prod: 46.30.204.47 ;</li><li>port ssh si non standard (22/TCP): 5700.</li></ul><p>Il nous manque donc un mot de passe ou une clé. Normalement, c&rsquo;est à ce moment qu&rsquo;on se demande &ldquo;Mais que contiennent les backups ?&rdquo;:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_c8357e1edc0bcb36d507f7cb1c032116.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_c8357e1edc0bcb36d507f7cb1c032116.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_c8357e1edc0bcb36d507f7cb1c032116.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_c8357e1edc0bcb36d507f7cb1c032116.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_c8357e1edc0bcb36d507f7cb1c032116.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_c8357e1edc0bcb36d507f7cb1c032116.png></p><p>Ca tombe bien. Pour info, un <code>unzip -l *</code> ne fonctionne pas, je ne me suis pas amusé à faire un <code>for</code> pour le plaisir.</p><p>De toute façon, nous sommes face à une archive chiffrée:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_d22311b9aad612d1b436487bd861204b.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_d22311b9aad612d1b436487bd861204b.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_d22311b9aad612d1b436487bd861204b.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_d22311b9aad612d1b436487bd861204b.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_d22311b9aad612d1b436487bd861204b.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_d22311b9aad612d1b436487bd861204b.png></p><h2 id=déchiffrement-du-zip>Déchiffrement du zip</h2><p>S&rsquo;il a créé un zip chiffré, il a dû faire la commande <code>zip</code> à un moment donné. Regardons dans le <code>.bash_history</code>:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_9cfe412881b3b3f49d139477dd7de276.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_9cfe412881b3b3f49d139477dd7de276.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_9cfe412881b3b3f49d139477dd7de276.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_9cfe412881b3b3f49d139477dd7de276.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_9cfe412881b3b3f49d139477dd7de276.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_9cfe412881b3b3f49d139477dd7de276.png></p><p>Une variable d&rsquo;environnement pour le password, ça nous fait une belle jambe. Il n&rsquo;y a plus qu&rsquo;à espérer que cette variable ait été initialisée dans ce même bash:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_39a70f75cdab1e9e06b14c03bfdac395.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_39a70f75cdab1e9e06b14c03bfdac395.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_39a70f75cdab1e9e06b14c03bfdac395.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_39a70f75cdab1e9e06b14c03bfdac395.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_39a70f75cdab1e9e06b14c03bfdac395.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_39a70f75cdab1e9e06b14c03bfdac395.png></p><p>On a encore eu de la chance. Le mot de passe du zip est donc <code>25362</code>. Lors de l&rsquo;extraction d&rsquo;un zip, quelque chose de rigolo se passe:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_7c428c87cc72aa9956bcd8f1dcf1186b.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_7c428c87cc72aa9956bcd8f1dcf1186b.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_7c428c87cc72aa9956bcd8f1dcf1186b.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_7c428c87cc72aa9956bcd8f1dcf1186b.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_7c428c87cc72aa9956bcd8f1dcf1186b.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_7c428c87cc72aa9956bcd8f1dcf1186b.png></p><p>Après, il y a 9 zip, c&rsquo;est peut être la clé de l&rsquo;un d&rsquo;entre eux. Pour celà, bash for the win:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=k>for</span> i in <span class=k>$(</span>ls<span class=k>)</span><span class=p>;</span> <span class=k>do</span> <span class=nb>echo</span> <span class=nv>$i</span> <span class=o>&amp;&amp;</span> 7z t <span class=nv>$i</span> -p25362<span class=p>|</span>grep Ok<span class=p>;</span> <span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_aeb27beeded836e41cc8e22194b5ce73.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_aeb27beeded836e41cc8e22194b5ce73.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_aeb27beeded836e41cc8e22194b5ce73.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_aeb27beeded836e41cc8e22194b5ce73.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_aeb27beeded836e41cc8e22194b5ce73.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_aeb27beeded836e41cc8e22194b5ce73.png></p><p>Il semblerait qu&rsquo;une archive puisse être déchiffrée:</p><blockquote><p>dev_141219_backup.zip</p></blockquote><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_deab0aea70f4aa4fd66bca331172fc83.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_deab0aea70f4aa4fd66bca331172fc83.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_deab0aea70f4aa4fd66bca331172fc83.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_deab0aea70f4aa4fd66bca331172fc83.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_deab0aea70f4aa4fd66bca331172fc83.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_deab0aea70f4aa4fd66bca331172fc83.png></p><p>Bonne nouvelle&mldr; Enfin presque:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_ad0d545d64bb6b3538ebb23050977620.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_ad0d545d64bb6b3538ebb23050977620.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_ad0d545d64bb6b3538ebb23050977620.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_ad0d545d64bb6b3538ebb23050977620.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_ad0d545d64bb6b3538ebb23050977620.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_ad0d545d64bb6b3538ebb23050977620.png></p><p>Il semblerait que l&rsquo;authentification SSH ait besoin d&rsquo;une clé ET d&rsquo;un mot de passe.</p><h2 id=el-famoso-passwordo>El famoso passwordo</h2><p>Je dois avouer que j&rsquo;ai passé un peu de temps à chercher ce mot de passe dans les autres layers, bruteforce sans succès les autres zip pour voir si la clé changeait, etc&mldr; Mais au final, je me suis rappelé qu&rsquo;à la création de ce layer, l&rsquo;utilisateur avait supprimé 2 fichiers:</p><ul><li><code>.bash_history</code></li><li><code>.bashrc</code></li></ul><p>Que contient le <code>.bashrc</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat .bashrc<span class=p>|</span>grep -v <span class=s1>&#39;#&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_e21ffd52a175782c534915243a3e0d6f.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_e21ffd52a175782c534915243a3e0d6f.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_e21ffd52a175782c534915243a3e0d6f.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_e21ffd52a175782c534915243a3e0d6f.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_e21ffd52a175782c534915243a3e0d6f.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_e21ffd52a175782c534915243a3e0d6f.png></p><p>La fameux mot de passe:</p><blockquote><p>HoHoHo2020!NorthPole</p></blockquote><p>Il ne reste qu&rsquo;à se connecter et collecter ce flag tant attendu:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_af912408ac7271a7fb45d76988dd51ba.png data-srcset="/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_af912408ac7271a7fb45d76988dd51ba.png, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_af912408ac7271a7fb45d76988dd51ba.png 1.5x, /lib/images/writeups/2019_santhacklaus/naughtydocker/upload_af912408ac7271a7fb45d76988dd51ba.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_af912408ac7271a7fb45d76988dd51ba.png title=/lib/images/writeups/2019_santhacklaus/naughtydocker/upload_af912408ac7271a7fb45d76988dd51ba.png></p><h2 id=flag>Flag</h2><blockquote><p>SANTA{NeverTrustDockerImages7263}</p></blockquote></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.100.2">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2017 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=maki.bzh/ target=_blank>Maki - Alan Marrec</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},lightgallery:!0}</script><script type=text/javascript src=/maki.bzh/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-WVPYCS7SPM',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-WVPYCS7SPM" async></script></body></html>