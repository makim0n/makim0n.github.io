<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>[TamuCTF 2019] - Reading rainbow - Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)</title><meta name=Description content="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><meta property="og:title" content="[TamuCTF 2019] - Reading rainbow"><meta property="og:description" content="Recently, the office put up a private webserver to store important information about the newest research project for the company. This information was to be kept confidential, as it&rsquo;s release could mean a large loss for everyone in the office. Just as the research was about to be published, a competing firm published information eerily similar. Too similar&mldr; Time to take a look through the office network logs to figure out what happened."><meta property="og:type" content="article"><meta property="og:url" content="maki.bzh/writeups/tamu2019readingrainbow/"><meta property="og:image" content="/logo.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2019-02-28T21:57:40+08:00"><meta property="article:modified_time" content="2019-02-28T21:57:40+08:00"><meta property="og:site_name" content="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/logo.png"><meta name=twitter:title content="[TamuCTF 2019] - Reading rainbow"><meta name=twitter:description content="Recently, the office put up a private webserver to store important information about the newest research project for the company. This information was to be kept confidential, as it&rsquo;s release could mean a large loss for everyone in the office. Just as the research was about to be published, a competing firm published information eerily similar. Too similar&mldr; Time to take a look through the office network logs to figure out what happened."><meta name=application-name content="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><meta name=apple-mobile-web-app-title content="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=maki.bzh/writeups/tamu2019readingrainbow/><link rel=prev href=maki.bzh/writeups/otterctf2018memorydump/><link rel=next href=maki.bzh/writeups/tamu2019microservices/><link rel=stylesheet href=/maki.bzh/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"[TamuCTF 2019] - Reading rainbow","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"maki.bzh\/writeups\/tamu2019readingrainbow\/"},"image":["\/images\/Apple-Devices-Preview.png"],"genre":"writeups","keywords":"tamuctf, forensic, network, wireshark, pcap, cryptography, det","wordcount":1297,"url":"maki.bzh\/writeups\/tamu2019readingrainbow\/","datePublished":"2019-02-28T21:57:40+08:00","dateModified":"2019-02-28T21:57:40+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"\/lib\/images\/avatar.png"},"author":{"@type":"Person","name":"Maki"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'dark'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'dark'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=maki.bzh/ title="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/maki.bzh/posts/>Posts </a><a class=menu-item href=/maki.bzh/shorts/>Shorts </a><a class=menu-item href=/maki.bzh/offers/>Offers </a><a class=menu-item href=/maki.bzh/writeups/>Writeups </a><a class=menu-item href=/maki.bzh/tags/>Tags </a><a class=menu-item href=/maki.bzh/about/>About </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=maki.bzh/ title="Maki's adventure | Internet of things, IoT, ICS, forensic, pentest, red team & more :)"><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/maki.bzh/posts/ title>Posts</a><a class=menu-item href=/maki.bzh/shorts/ title>Shorts</a><a class=menu-item href=/maki.bzh/offers/ title>Offers</a><a class=menu-item href=/maki.bzh/writeups/ title>Writeups</a><a class=menu-item href=/maki.bzh/tags/ title>Tags</a><a class=menu-item href=/maki.bzh/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster">[TamuCTF 2019] - Reading rainbow</h1><div class=content id=content><blockquote><p>Recently, the office put up a private webserver to store important information about the newest research project for the company. This information was to be kept confidential, as it&rsquo;s release could mean a large loss for everyone in the office.
Just as the research was about to be published, a competing firm published information eerily similar. Too similar&mldr;
Time to take a look through the office network logs to figure out what happened.</p></blockquote><ul><li>What is the IP address of the private webserver?</li><li>How many hosts made contact with the private webserver that day?</li></ul><table><thead><tr><th>Filename</th><th>MD5 Hash</th><th>Download link</th></tr></thead><tbody><tr><td>capture.pcap</td><td>e36ff23c6995e3595035982cced6c6a9</td><td><a href=https://mega.nz/#!aihUgK6I!a9Lvt6R1bBKit_bE8oOSQAUCdnl9LX_5egidhK5veRM target=_blank rel="noopener noreffer">https://mega.nz/#!aihUgK6I!a9Lvt6R1bBKit_bE8oOSQAUCdnl9LX_5egidhK5veRM</a></td></tr></tbody></table><p>In this task, the challenge deal with a PCAP file, I let you check my article about <a href=/articles/wiresharkhowtobasic/ rel>PCAP analysis</a>.</p><p>The first flag is to find the internal IP address of a web server. Since PCAP is quite large, I just have to load it into <code>Capanalysis</code> and filter on the <strong>SSL</strong> and <strong>HTTP</strong> protocols, then filter on the IP that receives the most data:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_tamuctf/readingrainbow/0_netenum_chall11.png data-srcset="/lib/images/writeups/2019_tamuctf/readingrainbow/0_netenum_chall11.png, /lib/images/writeups/2019_tamuctf/readingrainbow/0_netenum_chall11.png 1.5x, /lib/images/writeups/2019_tamuctf/readingrainbow/0_netenum_chall11.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_tamuctf/readingrainbow/0_netenum_chall11.png title=/lib/images/writeups/2019_tamuctf/readingrainbow/0_netenum_chall11.png></p><p>It was the web server we were looking for:</p><blockquote><p>Flag 1: 192.168.11.4</p></blockquote><p>Now the second challenge is to find the number of IP addresses that have connected to this webserver. Since we know his IP address, with <code>tshark</code> it&rsquo;s pretty easy:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>▶ tshark -r capture.pcap -Y <span class=s2>&#34;ip.dst == 192.168.11.4&#34;</span> -Tfields -e <span class=s1>&#39;ip.src&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq
</span></span><span class=line><span class=cl>128.194.165.200
</span></span><span class=line><span class=cl>172.217.6.138
</span></span><span class=line><span class=cl>172.226.209.130
</span></span><span class=line><span class=cl>192.168.1.1
</span></span><span class=line><span class=cl>192.168.11.5
</span></span><span class=line><span class=cl>192.168.11.7
</span></span><span class=line><span class=cl>192.168.11.8
</span></span><span class=line><span class=cl>192.168.11.9
</span></span><span class=line><span class=cl>35.222.85.5
</span></span><span class=line><span class=cl>35.224.99.156
</span></span><span class=line><span class=cl>52.43.40.243
</span></span><span class=line><span class=cl>54.213.168.194
</span></span><span class=line><span class=cl>91.189.92.38
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>▶ tshark -r capture.pcap -Y <span class=s2>&#34;ip.dst == 192.168.11.4&#34;</span> -Tfields -e <span class=s1>&#39;ip.src&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq <span class=p>|</span> wc -l
</span></span><span class=line><span class=cl><span class=m>13</span>
</span></span></code></pre></td></tr></table></div></div><p>Fortunately, all connections are done on the same day::</p><blockquote><p>Flag 2: 13</p></blockquote><h2 id=1_discovery>1_Discovery</h2><ul><li>What is the IP address of the host exfiltrating data?</li><li>For how long did the exfiltration happen? (Round to the nearest second. Format: MM:SS)</li><li>What protocol/s was used to exfiltrate data? (Alphabetical order, all caps, comma separated, with spaces - ex: ABCD, BBCD)</li></ul><p>It&rsquo;s time to open this big PCAP file in Wireshark. Thanks to the first question, we know that the attack exfiltrates some data. The best filter for that is still: <code>data.data</code>:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall11.png data-srcset="/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall11.png, /lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall11.png 1.5x, /lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall11.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall11.png title=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall11.png></p><p>We can see that our web server (192.168.11.4) is chatting with another host (192.168.11.7) via weird ICMP requests. Let&rsquo;s see what these requests contain:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall12.png data-srcset="/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall12.png, /lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall12.png 1.5x, /lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall12.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall12.png title=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall12.png></p><p>If we get the first request with a <code>tshark</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>▶ tshark -r capture.pcap -Y <span class=s2>&#34;data.data &amp;&amp; ip.dst == 192.168.11.4&#34;</span> -Tfields -e <span class=s1>&#39;data.text&#39;</span> <span class=p>|</span> head -n <span class=m>1</span> <span class=p>|</span> xxd -r -p
</span></span><span class=line><span class=cl>SEx4IRV.746f74616c6c795f6e6f7468696e672e706466.REGISTER.6156eab6691f32b8350c45b3fc4aadc1               
</span></span></code></pre></td></tr></table></div></div><p>The data formatted like this looks a lot like the <a href=https://github.com/sensepost/DET target=_blank rel="noopener noreffer">DET (Data Exfiltration Toolkit)</a> framework. I had already talked about it in a writeup at the <a href=/walkthrough/santhacklaus2018/#mission-impossible-2 rel>SantHackLause 2018</a>.</p><blockquote><p>Flag 1: 192.168.11.7</p></blockquote><p>Now we have to determine the duration of the exfiltration. With a small filter on IPs, we see some interesting things in the <code>DNS</code>:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall21.png data-srcset="/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall21.png, /lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall21.png 1.5x, /lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall21.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall21.png title=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall21.png></p><p>If we extract the last DNS request and this is indeed the last DET request, we should find a &ldquo;DONE&rdquo;:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>▶ <span class=nb>echo</span> -n <span class=s1>&#39;534578344952562e35312e444f4e45&#39;</span> <span class=p>|</span> xxd -r -p                          
</span></span><span class=line><span class=cl>SEx4IRV.51.DONE
</span></span></code></pre></td></tr></table></div></div><p>Perfect, we know the first request with the &ldquo;REGISTER&rdquo; and the last one with the &ldquo;DONE&rdquo;.</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall23.png data-srcset="/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall23.png, /lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall23.png 1.5x, /lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall23.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall23.png title=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall23.png>
<img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall22.png data-srcset="/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall22.png, /lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall22.png 1.5x, /lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall22.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall22.png title=/lib/images/writeups/2019_tamuctf/readingrainbow/1_disco_chall22.png></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>▶ <span class=nb>echo</span> <span class=k>$((</span><span class=m>35</span>.49-24.40<span class=k>))</span>                               
</span></span><span class=line><span class=cl>11.090000000000003
</span></span></code></pre></td></tr></table></div></div><p>The exfiltration lasted 11 minutes and 9 seconds:</p><blockquote><p>Flag 2: 11.09</p></blockquote><p>The last step will be the simplest, we already have all the information, to find the protocols, we will do a little tshark trick:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>▶ tshark -r capture.pcap -Y <span class=s2>&#34;ip.src == 192.168.11.4 &amp;&amp; ip.dst == 192.168.11.7&#34;</span> -Tfields -e <span class=s1>&#39;_ws.col.Protocol&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq 
</span></span><span class=line><span class=cl>DNS
</span></span><span class=line><span class=cl>HTTP
</span></span><span class=line><span class=cl>ICMP
</span></span><span class=line><span class=cl>TCP
</span></span></code></pre></td></tr></table></div></div><p>The &ldquo;TCP&rdquo; protocol is not counted since it is a transport protocol (see OSI Model).</p><blockquote><p>Flag 3: DNS, HTTP, ICMP</p></blockquote><h2 id=2_exfiltration>2_Exfiltration</h2><ul><li>What is the name of the stolen file?</li><li>What is the md5sum of the stolen file?</li></ul><p>These questions are a little bit easy since we know that the attacker used DET. First request contains both flags:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SEx4IRV.746f74616c6c795f6e6f7468696e672e706466.REGISTER.6156eab6691f32b8350c45b3fc4aadc1
</span></span></code></pre></td></tr></table></div></div><ul><li>SEx4IRV</li><li>746f74616c6c795f6e6f7468696e672e706466</li><li>REGISTER</li><li>6156eab6691f32b8350c45b3fc4aadc1</li></ul><p>The first hexadecimal sequence is the name of the encoded extracted file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>▶ <span class=nb>echo</span> -n <span class=s1>&#39;746f74616c6c795f6e6f7468696e672e706466&#39;</span> <span class=p>|</span> xxd -r -p                              
</span></span><span class=line><span class=cl>totally_nothing.pdf
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Flag 1: totally_nothing.pdf</p></blockquote><p>The second hexadecimal sequence is the MD5 hash of the encoded extracted file:</p><blockquote><p>Flag 2: 6156eab6691f32b8350c45b3fc4aadc1</p></blockquote><h2 id=3_data>3_Data</h2><ul><li>What compression encoding was used for the data?</li><li>What is the name and type of the decompressed file? (Format: NAME.TYPE e.g. tamuctf.txt)</li></ul><p>Before answering the questions, it will be necessary to find a way to recover the original file. We know that the attacker used HTTP, DNS and ICMP protocols between IP 192.168.11.7 (attacker) and 192.168.11.4 (webserver) to extract his file. We will, therefore, use the following filter and save only the displayed packets to make a lightened PCAP file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ip.src <span class=o>==</span> 192.168.11.4 <span class=o>&amp;&amp;</span> ip.dst <span class=o>==</span> 192.168.11.7 <span class=o>&amp;&amp;</span> <span class=o>(</span>http <span class=o>||</span> dns <span class=o>||</span> icmp
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_tamuctf/readingrainbow/3_exfil_chall11.png data-srcset="/lib/images/writeups/2019_tamuctf/readingrainbow/3_exfil_chall11.png, /lib/images/writeups/2019_tamuctf/readingrainbow/3_exfil_chall11.png 1.5x, /lib/images/writeups/2019_tamuctf/readingrainbow/3_exfil_chall11.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_tamuctf/readingrainbow/3_exfil_chall11.png title=/lib/images/writeups/2019_tamuctf/readingrainbow/3_exfil_chall11.png></p><p>We go from 15k packets to 117, it&rsquo;s still more pleasant to analyze.</p><h3 id=get-data-from-icmp>Get data from ICMP</h3><p>ICMP data is sent in hexadecimal when decoding on the fly with <code>xxd</code> piped to <code>tshark</code> there is no more line break and the data becomes difficult to analyze. For that, there is <code>sed</code> which will add more returns to the line:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>▶ tshark -r exfil.pcap -Y <span class=s2>&#34;icmp&#34;</span> -Tfields -e <span class=s2>&#34;data.text&#34;</span> <span class=p>|</span> xxd -r -p <span class=p>|</span> sed <span class=s1>&#39;s/SEx4IRV/\nSEx4IRV/g&#39;</span>
</span></span><span class=line><span class=cl>SEx4IRV.746f74616c6c795f6e6f7468696e672e706466.REGISTER.6156eab6691f32b8350c45b3fc4aadc1
</span></span><span class=line><span class=cl>SEx4IRV.2.85a846255178c4cbbd77ee999d7b7736892afaa392cf6ae7ccf9ee39f79efb9c3367325a767c1c7db414c0d4dadc4c78b0b5
</span></span><span class=line><span class=cl>SEx4IRV.12.2bb53aaf40c5354868c984db4df8b209379f172b26dcbc5f6e99f04a130ef3e234f944e875a64f746d26fc920977987079ee
</span></span><span class=line><span class=cl><span class=o>[</span>...<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>▶ tshark -r exfil.pcap -Y <span class=s2>&#34;icmp&#34;</span> -Tfields -e <span class=s2>&#34;data.text&#34;</span> <span class=p>|</span> xxd -r -p <span class=p>|</span> sed <span class=s1>&#39;s/SEx4IRV/\nSEx4IRV/g&#39;</span> &gt; clear_icmp
</span></span></code></pre></td></tr></table></div></div><p>These are the ICMP data extracted from a file.</p><h3 id=get-data-from-http>Get data from HTTP</h3><p>HTTP data are sent as POST data:</p><p><img class=lazyload src=/maki.bzh/svg/loading.min.svg data-src=/lib/images/writeups/2019_tamuctf/readingrainbow/3_exfil_chall12.png data-srcset="/lib/images/writeups/2019_tamuctf/readingrainbow/3_exfil_chall12.png, /lib/images/writeups/2019_tamuctf/readingrainbow/3_exfil_chall12.png 1.5x, /lib/images/writeups/2019_tamuctf/readingrainbow/3_exfil_chall12.png 2x" data-sizes=auto alt=/lib/images/writeups/2019_tamuctf/readingrainbow/3_exfil_chall12.png title=/lib/images/writeups/2019_tamuctf/readingrainbow/3_exfil_chall12.png></p><p>Same process as for ICMP:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>▶ tshark -r exfil.pcap -Y <span class=s2>&#34;http&#34;</span> -Tfields -e urlencoded-form.value <span class=p>|</span> xxd -r -p <span class=p>|</span> sed <span class=s1>&#39;s/SEx4IRV/\nSEx4IRV/g&#39;</span>               
</span></span><span class=line><span class=cl>SEx4IRV.0.1f8b080094e16c5c0003ed596b6c1c5715beb30f7b9dd8eb4dea249b07cdb64d8493ca9b5d3b7ea4698877fd1a83ed98d40e
</span></span><span class=line><span class=cl>SEx4IRV.1.01ea4cd7deb1bdb00f6b77b6d8018125a755b7a94390a0ca1f50a5a20a103f5ca844040236b82a25bf1250451005b9555339
</span></span><span class=line><span class=cl>SEx4IRV.3.3960e6981a034d81000a36ed6f6a0ab6049a5b5a5120d818686c41bec047ec17a56c468ba47d3ea44512d931adfc50dcadfc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>▶ tshark -r exfil.pcap -Y <span class=s2>&#34;http&#34;</span> -Tfields -e urlencoded-form.value <span class=p>|</span> xxd -r -p <span class=p>|</span> sed <span class=s1>&#39;s/SEx4IRV/\nSEx4IRV/g&#39;</span> &gt; clear_http
</span></span></code></pre></td></tr></table></div></div><h3 id=get-data-from-dns>Get data from DNS</h3><p>The functioning of the DNS is a bit more different, because each request will be encoded in another.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>▶ tshark -r exfil.pcap -Y <span class=s2>&#34;dns&#34;</span> -Tfields -e dns.qry.name <span class=p>|</span> cut -d<span class=s1>&#39;.&#39;</span> -f2 <span class=p>|</span> xxd -r -p <span class=p>|</span> sed <span class=s1>&#39;s/SEx4IRV/\nSEx4IRV/g&#39;</span>
</span></span><span class=line><span class=cl>SEx4IRV.5.a6cb22df81782e99b8f30efd5976f11c219f61477c5da8d1d1851a1fc79f60ed4ed9783b1bb3cb33bb3cd307bec21c5b11fa
</span></span><span class=line><span class=cl>SEx4IRV.7.d868cbfe7df168433c96cc4e374cb7b534b4ecf76752fe46ea9387e9f60c0c537d32df30b4a4bc8e61a4fcedfa9fff74f35f
</span></span><span class=line><span class=cl>SEx4IRV.8.af6baf4c5fb9f1cbf7479e0bfce2f22b44d7858af346e66396d9137c6238025db0a4cf2098419e36e0ff460bbca10cee2d83
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>▶ tshark -r exfil.pcap -Y <span class=s2>&#34;dns&#34;</span> -Tfields -e dns.qry.name <span class=p>|</span> cut -d<span class=s1>&#39;.&#39;</span> -f2 <span class=p>|</span> xxd -r -p <span class=p>|</span> sed <span class=s1>&#39;s/SEx4IRV/\nSEx4IRV/g&#39;</span> &gt; clear_dns
</span></span></code></pre></td></tr></table></div></div><h3 id=ordering-each-request>Ordering each request</h3><p>All requests must be put back in the right order. This is how DET works:</p><ol><li>File ID</li><li>Packet number</li><li>Data</li></ol><p>This query construction is not valid for the first (REGISTER) and last (DONE) requests.
To put all this in order, python will do it for us. I will put all the lines in a dictionary with the packet number as the key:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>f</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;clear_data&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>final</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>tmp</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=nb>len</span><span class=p>(</span><span class=n>a</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>	<span class=n>tmp</span><span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>])]</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=nb>len</span><span class=p>(</span><span class=n>tmp</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>	<span class=n>final</span> <span class=o>=</span> <span class=n>tmp</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;result&#39;</span><span class=p>,</span><span class=s1>&#39;wb&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>g</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>final</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>g</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>Here is what we obtain:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>▶ file result 
</span></span><span class=line><span class=cl>result: ASCII text, with very long lines, with no line terminators
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>▶ cat result                    
</span></span><span class=line><span class=cl>1f8b080094e16c5c0003ed596b6c1c5715beb30f7b9dd8eb4dea249b07cdb64d8493ca9b5d3b7ea4698877fd1a83ed98d40e01ea4cd7deb1bdb00f6b7
</span></span><span class=line><span class=cl><span class=o>[</span>...<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>▶ cat result <span class=p>|</span> xxd -r -p &gt; <span class=nb>test</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>▶ file <span class=nb>test</span>    
</span></span><span class=line><span class=cl>test: gzip compressed data, last modified: Wed Feb <span class=m>20</span> 05:11:48 2019, from Unix, original size <span class=m>10240</span>
</span></span></code></pre></td></tr></table></div></div><p>Remember the first question of the challenge is the type of compression used:</p><blockquote><p>Flag 1: gzip</p></blockquote><p>Now, let&rsquo;s uncompress the archive and got the original file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>▶ mv <span class=nb>test</span> test.gz                                                             
</span></span><span class=line><span class=cl>                                                                        
</span></span><span class=line><span class=cl>▶ gzip -d test.gz            
</span></span><span class=line><span class=cl>                                                                        
</span></span><span class=line><span class=cl>▶ file <span class=nb>test</span> 
</span></span><span class=line><span class=cl>test: POSIX tar archive <span class=o>(</span>GNU<span class=o>)</span>
</span></span><span class=line><span class=cl>                                                                          
</span></span><span class=line><span class=cl>▶ tar xvf <span class=nb>test</span>    
</span></span><span class=line><span class=cl>stuff                                                                            
</span></span><span class=line><span class=cl>▶ file stuff 
</span></span><span class=line><span class=cl>stuff: ELF 64-bit LSB shared object, x86-64, version <span class=m>1</span> <span class=o>(</span>SYSV<span class=o>)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, <span class=k>for</span> GNU/Linux 3.2.0, BuildID<span class=o>[</span>sha1<span class=o>]=</span>e228bab316deed74b478d8f5bdef5d8c30bbd1b4, not stripped
</span></span></code></pre></td></tr></table></div></div><p>And now, let&rsquo;s validate the last flag:</p><blockquote><p>Flag 2: stuff.elf</p></blockquote></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.100.2">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2017 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=maki.bzh/ target=_blank>Maki - Alan Marrec</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},lightgallery:!0}</script><script type=text/javascript src=/maki.bzh/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-WVPYCS7SPM',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-WVPYCS7SPM" async></script></body></html>